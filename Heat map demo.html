<!-- saved from url=(0046)https://www.ibiblio.org/e-notes/ml/heatmap.htm -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat map demo</title>
    <script src="./Heat map demo_files/tf.min.js.download"> </script>
    <script src="./Heat map demo_files/util.js.download"> </script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <style type="text/css">
      H1{ font-size: 120%; color: green}
      H2{ font-size: 100%; color: green}
    </style>
  </head>
<body data-gr-c-s-loaded="true">
<h1>Interactive Heat map demo</h1>

<div class="container">
  <div class="row">
    <div class="col-8 bg-light">
      <canvas id="rectcnv" style="border:1px solid grey; position: absolute;" width="500" height="400"></canvas>
      <canvas id="imgcnv" contenteditable="" style="border:1px solid grey;" width="500" height="400"></canvas>
    </div>
    <div class="col-4 bg-white">
      <div class="col-12">
        <!-- class <input size="1" id = "user_input" value="849" onchange="makeModel(this.value); classify();"> -->
        visualise class: <div id = "user_input" value="849">333</div>
        <!-- class <input size="1" id = "user_input" value="849" "> -->
        <input type="checkbox" onclick="chkMax = checked; classify();" checked="">actMax
        <input size="1" value="34" onchange="actMax=parseFloat(this.value); classify();">
      </div>
      <div class="col-12">
        <canvas id="outcnv2" style="border:1px solid greenyellow; position: absolute;" width="224" height="224"></canvas>
        <canvas id="outcnv" style="border:1px solid grey;" width="224" height="224"></canvas>
      </div>
      <div class="col-12" id="output">
        probability / class / name 
        <br>0.876 - 985 - daisy
        <br>0.050 - 310 - ant, emmet, pismire
        <br>0.029 - 723 - pinwheel
      </div>
      <br>
      click to see the class activation map of:
      <div class="col-12">
        <br>
        <button class="btn btn-block btn-outline-dark" id='btn_1st_prob' 
                 value = "" 
                 onclick="makeModel(this.value); 
                 classify();"></button>
        <button class="btn btn-block btn-outline-dark" id='btn_2st_prob' value = "" 
                      onclick="makeModel(this.value); classify();"></button>
        <button class="btn btn-block btn-outline-dark">teapot</button>
      </div>

      <div class="col-12">
        <br>

        <div class="btn-group-toggle btn-group-vertical" data-toggle="buttons">
          <label class="btn btn-outline-secondary active">
            <input type="radio" name="options" id="option1" checked> Radio 1 (preselected)
          </label>
          <label class="btn btn-outline-secondary">
            <input type="radio" name="options" id="option2"> Radio 2
          </label>
          <label class="btn btn-outline-secondary">
            <input type="radio" name="options" id="option3"> Radio 3
          </label>
        </div>
      </div>

      <script src="main.js"></script>
    </div>
  </div>
</div>

<!-- <table><tbody><tr><td>
  <div>
    <canvas id="rectcnv" style="border:1px solid grey; position: absolute;" width="500" height="400"></canvas>
    <canvas id="imgcnv" contenteditable="" style="border:1px solid grey;" width="500" height="400"></canvas>
  </div>
</td><td valign="top">
  class <input size="1" value="985" onchange="makeModel(this.value); classify();">
  <input type="checkbox" onclick="chkMax = checked; classify();" checked="">actMax
  <input size="1" value="34" onchange="actMax=parseFloat(this.value); classify();">
  <div>
    <canvas id="outcnv2" style="border:1px solid grey; position: absolute;" width="224" height="224"></canvas>
    <canvas id="outcnv" style="border:1px solid grey;" width="224" height="224"></canvas>
  </div>
<div id="output">probability / class / name<br>0.876 - 985 - daisy<br>0.050 - 310 - ant, emmet, pismire<br>0.029 - 723 - pinwheel</div>
</td></tr></tbody></table> -->

<!-- Drag mouse (from the top to the right) to mark a new region for inference.
Use the A,S,D,W keys to translate and J,K,L,I to enlarge bounding box (hold the Shift key
to move x10 faster). This region from the source image (see its position,
width and height in console) is scaled into 224x224 image and is shown to the right.
Open a new browser window (or tab) and Copy / Paste(Ctrl+V) images from
 <a href="https://image.google.com/">image.google.com</a>,
 <a href="https://unsplash.com/s/photos/cat">unsplash.com</a>, ... 

<p>This application shows which areas of the image contribute
 the most to the "daisy" prediction.
The brightness of the image is proportional to exp(0.1 (Aij - max)),
 where Aij - activations in the "daisy" class on 7x7 grid
(see the Aij maximum and average values in console),
 max - is the maximum Aij value or is equal to "actMax" (if checked).
You can set new Heat map Class and actMax values.

</p><p>Unfortunately it is not clear what features give activations.

 </p><h2>Class Activation Mapping and CNN surgery</h2>

 As you can see below ("mobilenet.summary()" is used),
 the 1024-features map (or embeddings or activations)
 of the MobileNet_v1_1.0_224 is made by the Global Average Pooling (GAP) over
 the 7�7 space grid of the preceding [7,7,1024]-features map.
 <br>See also <a href="https://www.ibiblio.org/e-notes/ml/quant/weights.htm">MobileNet v1 Layers model analysis</a> or
 You can use e.g. "JSON Viewer Awesome" Chrome extension to explore
 <a href="https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/model.json">model.json</a>
 file.

<pre>conv_pw_13_relu              [null,7,7,1024]
____________________________________________
global_average_pooling2d_1   [null,1024]
</pre>

<img width="30%" title="heat map" src="./Heat map demo_files/heat.jpg">
<img width="33%" title="heat_nearest map" src="./Heat map demo_files/heat_nearest.jpg">

<br>Therefore, if we cut off the GAP layer, we will get localization of activations
 in the "daisy" channel on the 7�7 space grid. You can see above activations
 in bilinear interpolated and nearest modes. See also
<a href="https://www.ibiblio.org/e-notes/ml/webgl/heat_daisy.htm">"Daisy" Class Activation Mapping</a>.

<hr><a href="https://www.ibiblio.org/e-notes/ml/notes.htm">TFjs notes</a>
&nbsp; &nbsp; <i>updated</i> 11 Jan 2020 -->


<iframe frameborder="0" scrolling="no" style="background-color: transparent; border: 0px; display: none;" src="./Heat map demo_files/saved_resource.html"></iframe><div id="GOOGLE_INPUT_CHEXT_FLAG" input="" input_stat="{&quot;tlang&quot;:true,&quot;tsbc&quot;:true,&quot;pun&quot;:true,&quot;mk&quot;:true,&quot;ss&quot;:true}" style="display: none;"></div></body></html>